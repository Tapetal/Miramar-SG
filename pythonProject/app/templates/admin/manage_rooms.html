<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='admin/css/manage_rooms.css') }}">
    <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.0/css/line.css">
    <title>Miramar Hotel - Room Management</title>
</head>
<body>
    <nav>
        <div class="logo-name">
            <div class="logo-image">
                <a href="#"><img src="{{ url_for('static', filename='user/assets/assets3/Hotel_White.png') }}" alt="Miramar Hotel"></a>
            </div>
            <span class="logo_name">Miramar Hotel</span>
        </div>

        <div class="menu-items">
            <ul class="nav-links">
                <li><a href="{{ url_for('dashboard') }}">
                    <i class="uil uil-estate"></i>
                    <span class="link-name">Dashboard</span>
                </a></li>
                <li><a href="{{ url_for('manage_rooms') }}" class="active">
                    <i class="uil uil-bed-double"></i>
                    <span class="link-name">Rooms</span>
                </a></li>
                <li><a href="{{ url_for('manage_customers') }}">
                    <i class="uil uil-users-alt"></i>
                    <span class="link-name">Customers</span>
                </a></li>
                <li><a href="{{ url_for('manage_bookings') }}">
                    <i class="uil uil-calendar-alt"></i>
                    <span class="link-name">Bookings</span>
                </a></li>
                <li><a href="{{ url_for('manage_feedback') }}">
                    <i class="uil uil-comment-alt-lines"></i>
                    <span class="link-name">Feedback</span>
                </a></li>
            </ul>

            <ul class="logout-mode">
                <li><a href="{{ url_for('admin_logout') }}">
                    <i class="uil uil-signout"></i>
                    <span class="link-name">Logout</span>
                </a></li>

                <li class="mode">
                    <a href="#" id="dark-mode-toggle">
                        <i class="uil uil-moon" id="mode-icon"></i>
                        <span class="link-name">Dark Mode</span>
                    </a>
                    <div class="mode-toggle">
                        <span class="switch"></span>
                    </div>
                </li>
            </ul>
        </div>
    </nav>

    <section class="dashboard">
        <div class="top">
            <i class="uil uil-bars sidebar-toggle"></i>

            <div class="search-box">
                <i class="uil uil-search"></i>
                <input type="text" id="search-input" placeholder="Search rooms by name or type...">
            </div>
            <a href="{{ url_for('admin_profile') }}">
                <img src="{{ url_for('static', filename='user/assets/pfl_dark.png') }}" class="profile" id="profileImage" />
            </a>
        </div>

        <div class="dash-content">
            <div class="title">
                <i class="uil uil-bed-double"></i>
                <span class="text">Room Management</span>
            </div>

            <!-- Room Stats -->
            <div class="room-stats">
                <div class="stat-card total">
                    <i class="uil uil-bed-double"></i>
                    <div class="stat-info">
                        <span class="stat-number" id="total-rooms">{{ rooms|length if rooms else 0 }}</span>
                        <span class="stat-label">Total Rooms</span>
                    </div>
                </div>
                <div class="stat-card available">
                    <i class="uil uil-check-circle"></i>
                    <div class="stat-info">
                        <span class="stat-number" id="available-rooms">{{ available_rooms or 0 }}</span>
                        <span class="stat-label">Available</span>
                    </div>
                </div>
                <div class="stat-card occupied">
                    <i class="uil uil-user-check"></i>
                    <div class="stat-info">
                        <span class="stat-number" id="occupied-rooms">{{ occupied_rooms or 0 }}</span>
                        <span class="stat-label">Occupied</span>
                    </div>
                </div>
                <div class="stat-card revenue">
                    <i class="uil uil-dollar-sign"></i>
                    <div class="stat-info">
                        <span class="stat-number" id="avg-price">${{ avg_price or '0' }}</span>
                        <span class="stat-label">Avg. Price</span>
                    </div>
                </div>
            </div>

            <!-- Action Tabs -->
            <div class="action-tabs">
                <button class="tab-btn active" data-tab="add-room">
                    <i class="uil uil-plus"></i>
                    Add New Room
                </button>
                <button class="tab-btn" data-tab="manage-rooms">
                    <i class="uil uil-list-ul"></i>
                    Manage Rooms
                </button>
            </div>

            <!-- Add Room Form -->
            <div class="tab-content" id="add-room">
                <div class="form-container">
                    <form id="create-room-form" method="POST" action="{{ url_for('create_room') }}" enctype="multipart/form-data">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="room-name">
                                    <i class="uil uil-tag-alt"></i>
                                    Room Name
                                </label>
                                <input type="text" id="room-name" name="room_name" placeholder="e.g., Deluxe Ocean View" required>
                            </div>

                            <div class="form-group">
                                <label for="room-type">
                                    <i class="uil uil-home"></i>
                                    Room Type
                                </label>
                                <select id="room-type" name="room_type" required>
                                    <option value="">Select Room Type</option>
                                    <option value="Standard">Standard</option>
                                    <option value="Deluxe">Deluxe</option>
                                    <option value="Suite">Suite</option>
                                    <option value="Presidential">Presidential</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="price">
                                    <i class="uil uil-dollar-sign"></i>
                                    Price per Night
                                </label>
                                <input type="number" id="price" name="price" placeholder="0.00" step="0.01" required>
                            </div>

                            <div class="form-group">
                                <label for="capacity">
                                    <i class="uil uil-users-alt"></i>
                                    Guest Capacity
                                </label>
                                <input type="number" id="capacity" name="capacity" placeholder="2" min="1" max="10" required>
                            </div>
                        </div>

                        <div class="form-group full-width">
                            <label for="room-image">
                                <i class="uil uil-image"></i>
                                Room Image
                            </label>
                            <div class="file-input-container">
                                <input type="file" id="room-image" name="room_image" accept="image/*" required>
                                <div class="file-input-display">
                                    <i class="uil uil-cloud-upload"></i>
                                    <span>Click to upload or drag and drop</span>
                                    <small>PNG, JPG, JPEG up to 5MB</small>
                                </div>
                            </div>
                        </div>

                        <div class="form-group full-width">
                            <label for="description">
                                <i class="uil uil-notes"></i>
                                Room Description
                            </label>
                            <textarea id="description" name="description" placeholder="Describe the room amenities, view, and features..." rows="4" required></textarea>
                        </div>

                        <div class="form-actions">
                            <button type="reset" class="btn-secondary">
                                <i class="uil uil-refresh"></i>
                                Reset Form
                            </button>
                            <button type="submit" class="btn-primary">
                                <i class="uil uil-plus"></i>
                                Create Room
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Manage Rooms Tab -->
            <div class="tab-content" id="manage-rooms" style="display: none;">
                <div class="table-container">
                    <div class="table-header">
                        <h3>All Rooms</h3>
                        <div class="table-actions">
                            <button class="action-btn export">
                                <i class="uil uil-export"></i>
                                <span>Export</span>
                            </button>
                        </div>
                    </div>

                    <table class="modern-table" id="rooms-table">
                        <thead>
                            <tr>
                                <th>Room ID</th>
                                <th>Room Details</th>
                                <th>Type & Capacity</th>
                                <th>Price</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="rooms-table-body">
                            {% if rooms %}
                                {% for room in rooms %}
                                    <tr class="room-row">
                                        <td>
                                            <div class="room-id">
                                                <span class="id-number">#{{ room.id }}</span>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="room-details">
                                                <div class="room-image">
                                                    <img src="{{ url_for('static', filename='uploads/' + room.image) if room.image else url_for('static', filename='user/assets/default-room.jpg') }}" alt="Room">
                                                </div>
                                                <div class="room-info">
                                                    <span class="room-name">{{ room.name }}</span>
                                                    <span class="room-description">{{ room.description[:50] + '...' if room.description and room.description|length > 50 else room.description or 'No description' }}</span>
                                                </div>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="type-capacity">
                                                <span class="room-type">{{ room.type }}</span>
                                                <span class="capacity">
                                                    <i class="uil uil-users-alt"></i>
                                                    {{ room.capacity or 'N/A' }} guests
                                                </span>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="price">
                                                <span class="currency">$</span>
                                                <span class="amount">{{ "%.2f"|format(room.price) }}</span>
                                                <span class="period">/night</span>
                                            </div>
                                        </td>
                                        <td>
                                            <span class="status-badge available">
                                                <i class="uil uil-check-circle"></i>
                                                Available
                                            </span>
                                        </td>
                                        <td>
                                            <div class="action-buttons">
                                                <button class="action-btn view" onclick="viewRoom({{ room.id }})">
                                                    <i class="uil uil-eye"></i>
                                                    <span>View</span>
                                                </button>
                                                <button class="action-btn edit" onclick="editRoom({{ room.id }})">
                                                    <i class="uil uil-edit"></i>
                                                    <span>Edit</span>
                                                </button>
                                                <button class="action-btn delete" onclick="deleteRoom({{ room.id }}, '{{ room.name }}')">
                                                    <i class="uil uil-trash-alt"></i>
                                                    <span>Delete</span>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                {% endfor %}
                            {% else %}
                                <tr>
                                    <td colspan="6" class="no-data">
                                        <i class="uil uil-bed-double"></i>
                                        <span>No rooms available</span>
                                    </td>
                                </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </section>

    <script>
        // Sidebar and dark mode functionality
        const body = document.querySelector("body");
        const sidebar = body.querySelector("nav");
        const sidebarToggle = body.querySelector(".sidebar-toggle");
        const modeToggle = body.querySelector(".mode-toggle");
        const modeIcon = body.querySelector("#mode-icon");
        const darkModeToggle = body.querySelector("#dark-mode-toggle");

        // Initialize dark mode
        let getMode = localStorage.getItem("mode");
        if (getMode && getMode === "dark") {
            body.classList.add("dark");
            modeIcon.classList.replace("uil-moon", "uil-sun");
        }

        // Initialize sidebar state
        let getStatus = localStorage.getItem("status");
        if (getStatus && getStatus === "close") {
            sidebar.classList.add("close");
        }

        // Dark mode toggle
        modeToggle.addEventListener("click", () => {
            body.classList.toggle("dark");
            if (body.classList.contains("dark")) {
                localStorage.setItem("mode", "dark");
                modeIcon.classList.replace("uil-moon", "uil-sun");
            } else {
                localStorage.setItem("mode", "light");
                modeIcon.classList.replace("uil-sun", "uil-moon");
            }
        });

        darkModeToggle.addEventListener("click", (e) => {
            e.preventDefault();
            modeToggle.click();
        });

        // Sidebar toggle
        sidebarToggle.addEventListener("click", () => {
            sidebar.classList.toggle("close");
            if (sidebar.classList.contains("close")) {
                localStorage.setItem("status", "close");
            } else {
                localStorage.setItem("status", "open");
            }
        });

        // Tab functionality
        const tabBtns = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');

        tabBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                const targetTab = btn.dataset.tab;
                
                // Update active tab button
                tabBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                
                // Show/hide tab content
                tabContents.forEach(content => {
                    if (content.id === targetTab) {
                        content.style.display = 'block';
                    } else {
                        content.style.display = 'none';
                    }
                });
            });
        });

        // File input enhancement
        const fileInput = document.getElementById('room-image');
        const fileDisplay = document.querySelector('.file-input-display');

        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                fileDisplay.innerHTML = `
                    <i class="uil uil-check-circle"></i>
                    <span>${file.name}</span>
                    <small>File selected</small>
                `;
                fileDisplay.style.borderColor = 'var(--success-color)';
                fileDisplay.style.background = 'rgba(16, 185, 129, 0.1)';
            }
        });

        // Search functionality
        const searchInput = document.getElementById('search-input');
        const roomsTable = document.getElementById('rooms-table-body');

        if (searchInput && roomsTable) {
            searchInput.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                const rows = roomsTable.querySelectorAll('.room-row');

                rows.forEach(row => {
                    const roomName = row.querySelector('.room-name')?.textContent.toLowerCase() || '';
                    const roomType = row.querySelector('.room-type')?.textContent.toLowerCase() || '';

                    if (roomName.includes(searchTerm) || roomType.includes(searchTerm)) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                });
            });
        }

        // Action functions
        function viewRoom(roomId) {
            alert(`View room details for ID: ${roomId}`);
        }

        function editRoom(roomId) {
            alert(`Edit room with ID: ${roomId}`);
        }

        function deleteRoom(roomId, roomName) {
            if (confirm(`Are you sure you want to delete room "${roomName}"? This action cannot be undone.`)) {
                // Implement delete functionality
                alert(`Delete room ${roomId}`);
            }
        }

        // Form validation
        document.getElementById('create-room-form').addEventListener('submit', function(e) {
            const price = parseFloat(document.getElementById('price').value);
            const capacity = parseInt(document.getElementById('capacity').value);
            
            if (price <= 0) {
                e.preventDefault();
                alert('Price must be greater than 0');
                return;
            }
            
            if (capacity <= 0 || capacity > 10) {
                e.preventDefault();
                alert('Capacity must be between 1 and 10 guests');
                return;
            }
        });
    </script>
</body>
</html>